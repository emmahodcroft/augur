from __future__ import print_function
import os, sys
# we assume (and assert) that this script is running from the virus directory, i.e. inside H7N9 or zika
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
import base.prepare
from base.prepare import prepare
from datetime import datetime
from base.utils import fix_names
import argparse

def collect_args():
    """Returns a tb-specific argument parser.
    """
    parser = base.prepare.collect_args()
    parser.set_defaults(
        viruses_per_month=15,
        file_prefix="tb"
    )
    return parser

dropped_strains = [
]

config = {
    "dir": "tb",
    "file_prefix": "tb",
    "title": "Real-time tracking of tb evolution",
    "maintainer": ["Hodcroft Neher", "https://neherlab.org/"],
    "input_paths": ["../../../fauna/data/tb.fasta"],
    "header_fields": {0:'strain', 2:'accession', 3:'date', 4:'region', 5:'country',
                    6:'division', 8:'db', 10:'authors', 11:'url', 12:'title',
                    13: 'journal', 14: 'paper_url'},
    "filters": (
        ("Dropped Strains", lambda s: s.id not in [fix_names(x) for x in dropped_strains]),
        ("Restrict Date Range", lambda s: s.attributes['date'] >= datetime(2000,01,1).date()),
        ("Restrict Date Range", lambda s: s.attributes['date'] <= datetime(2018,01,1).date()),
        ("Sequence Length", lambda s: len(s.seq)>=5000),
    ),
    "subsample": {
        "category": lambda x:(x.attributes['date'].year, x.attributes['date'].month, x.attributes['country']),
    },
    "colors": ["country", "region"],
    "color_defs": ["./colors.tsv"],
    "lat_longs": ["country", "region"],
    "auspice_filters": ["country", "region"],
    "reference": {
        "path": "metadata/tb_outgroup.gb",
        "metadata": {
            'strain': "AP014573", "accession": "AP014573", "date": "2014-04-08",
            'host': "human", 'country': "JAPAN"
        },
        "include": 2,
        "genes": ["echA5","pdc","ruvB","parA","PPE33","glpK","rimM","rpsD","PPE23","dapB","csd","kgd","fadD13","epiA","aldC","thyA","PPE43","gcp","mmpl14","fadD19","TB16.3","rfbE","sugI","fbpD","fadE14","dsbF","lpqR","mfd","lldD1","lipB","tam","ilvG","argC","glnA1","yjcE","pepA","mraY","tig","fadD24","chaA","cfp29","mntH","dnaG","rpsO","mutT1","eno","rne","lipD","pknH","plcB","ctpG","kgtP","pstA1","moaE1","frdC","fgd1","ribG","lipT","hemD","gshA","cyp124","argS","nadR","trcR","ahpE","whiB1","PPE56","pstC2","adhE1","kdpA","rpmB","lsr2","ssb","fbpC","gltD","mpt83","thiG","fdhF","gatC","esxC","rocA","mpt53","modC","rplW","mmr","fadD16","secE","dxr","lppP","glnH","dinP","PPE27","accD5","fadE24","ribF","ppsE","argB","fadD30","PE_PGRS34","leuS","mce3D","narG","mce3R","glnQ","ung","rpsG","oppD","oxyS","fusA2","lppZ","tpx","whiB6","rnc","PE_PGRS16","mtn","lprG","fusA1","ctaC","mrp","rpsP","hisE","dfrA","argR","scoA","nuoA","fadE4","ureF","nrdI","cysK2","lppW","lpdA","rpsS","PE19","cbhK","lpqK","mesJ","echA2","pepQ","proW","PE_PGRS33","guaB3","pgi","gabP","galE2","PE6","rpmG","ppsC","mobA","pcaA","metG","gca","pdxH","echA11","rubA","argH","sucD","rbfA","PE_PGRS52","recA","PE_PGRS38","proC","panC","xthA","phoH1","pcd","cyp139","echA18","hemN","dfp","tuf","ansP2","hspR","ctaD","qcrB","choD","embC","pyrE","phoR","nrdF","gyrB","aroK","echA3","atpC","cyp143","grpE","lpqE","folD","aspC","murE","lipM","PPE26","proA","mmsB","rhlE","leuC","PPE19","pstA2","murG","tatC","gadB","TB27.3","fadE6","lipP","coaA","fabG1","nadC","efpA","mmaA4","mpg","mbtD","sppA","fadA3","fadD11.1","fadD15","moeA2","narK2","PPE5","TB9.4","lprO","gcvH","mtr","murD","purE","rnhB","PPE46","rpsK","pth","lprA","gmhA","rplD","recX","fadE34","agpS","menB","nth","lpqP","mog","pgsA1","fadD1","fadD2","hsdM","bpoA","hemA","hflX","purQ","moaX","alkA","embR","aroA","moeX","hisA","narU","lppK","ilvE","mkl","ndh","papA3","lat","folB","fadE16","pdhC","PE_PGRS14","PPE41","lipF","fabG3","narJ","mhpE","rpmA","cut5a","cobS","PE-PGRS15","lipR","esxG","dhaA","xerC","hemH","cysW","PPE52","PPE36","atpE","sseC1","PE10","ald","PPE45","lprF","ftsK","fadE22","PPE38","udgA","groEL","mutT2","pdhA","proB","pra","lppF","ccrB","metH","moeY","clpC2","trpC"]
    }
}

#       "genes": ['dnaA', 'dnaN', 'recF', 'gyrB', 'gyrA', 'ppiA', 'trpG', 'pknB', 'pknA', 'pbpA', 'rodA', 'ppp', 'TB39.8', 'whiB5', 'bioF2', 'acpA', 'fadD34', 'mtc28', 'leuS', 'ino1', 'ponA1', 'rpsF', 'ssb', 'rpsR', 'rplI', 'dnaB', 'celA1', 'icd2', 'sdaA', 'glyA2', 'hycD', 'hycP', 'hycQ', 'hycE', 'mtn', 'ctpA', 'PPE1', 'fadD10', 'nrp', 'ctpB', 'rpmB', 'ctpI', 'PE_PGRS1', 'gca', 'gmhA', 'hddA', 'oxyS', 'oxcA', 'fadD7', 'fusA2', 'PE_PGRS2', 'pepA', 'treS', 'fbpC', 'fadE1', 'fgd2', 'ephF', 'cyp138', 'msrA', 'PE1', 'PE2', 'ptbB', 'fadE2', 'pntAa', 'pntAb', 'pntB', 'PE3', 'PE4', 'adhE1', 'TB18.5', 'fadD5', 'yrbE1A', 'yrbE1B', 'mce1A', 'mce1B', 'mce1C', 'mce1D', 'mec1E', 'mce1F', 'lprO', 'sigG', 'bglS', 'mymT', 'ilvD', 'mmpL11', 'mmpL3', 'trmB', 'pckA', 'nadR', 'fadD4', 'fadE3', 'lipW', 'lipC', 'echA1', 'php', 'fadE4', 'nrdB', 'gabD1', 'lpqI', 'fabG', 'fadA2', 'fadE5', 'sdhA', 'hsp', 'nirB', 'nirD', 'cobU', 'cobQ1', 'PPE2', 'narK3', 'aac', 'oplA', 'narU', 'fadD2', 'fadE6', 'PE-PGRS3', 'PE-PGRS4', 'PPE3', 'PE5', 'PPE4', 'esxG', 'esxH', 'mycP3', 'eccE3', 'tam', 'PE_PGRS5', 'PPE5', 'glpQ2', 'pcp', 'dcd', 'udgA', 'cyp135A1', 'rmlA', 'PE6', 'aspC', 'iniB', 'iniA', 'iniC', 'lpqJ', 'ansP2', 'dnaK', 'grpE', 'dnaJ1', 'hspR', 'PPE8', 'purA', 'mgtE', 'fba', 'secE2', 'pyrE', 'clpB', 'purT', 'metZ', 'ndhA', 'lpqK', 'fadE7', 'mmpL1', 'mmpS1', 'fadD30', 'pks6', 'fgd1', 'pta', 'ackA', 'pknG', 'glnH', 'mutT3', 'thiE', 'thiO', 'thiS', 'thiG', 'lpqL', 'lpqM', 'thiD', 'thiC', 'ctpH', 'xthA', 'def', 'sodC', 'pssA', 'psd', 'moeA2', 'groEL', 'PPE10', 'sigK', 'ufaA1', 'mmpL4', 'mmpS4', 'PPE11', 'echA2', 'mazF1', 'lpd', 'icl', 'fadB2', 'umaA', 'pcaA', 'hbhA', 'deoC', 'murB', 'lprQ', 'gpm1', 'senX3', 'regX3', 'proC', 'galE2', 'cmaA2', 'serB1', 'mmpS2', 'mmpL2', 'hemA', 'hemC', 'hemD', 'hemB', 'gabP', 'hemL', 'ccdA', 'ccsA', 'PE_PGRS6', 'menA', 'pnp', 'galE3', 'menE', 'pitA', 'menB', 'fadD8', 'menC', 'bpoC', 'menD', 'pimB', 'ubiE', 'grcC1', 'htpX', 'gpsA', 'cyp135B1', 'nrdZ', 'TB27.3', 'PE_PGRS7', 'lpqN', 'yrbE2A', 'yrbE2B', 'mce2A', 'mce2B', 'mce2C', 'mce2D', 'lprL', 'mce2F', 'tcrA', 'lpqO', 'galTa', 'galTb', 'galK', 'recD', 'recB', 'recC', 'echA3', 'rpmG', 'secE', 'nusG', 'rplK', 'rplA', 'mmaA4', 'mmaA3', 'mmaA2', 'mmaA1', 'lipG', 'fabD2', 'rplJ', 'rplL', 'mkl', 'atsD', 'rpoB', 'rpoC', 'end', 'lpqP', 'fadE8', 'echA4', 'echA5', 'mmpL5', 'mmpS5', 'rpsL', 'rpsG', 'fusA1', 'tuf', 'pqqE', 'lldD1', 'rpsJ', 'rplC', 'rplD', 'rplW', 'rplB', 'rpsS', 'rplV', 'rpsC', 'rplP', 'rpmC', 'rpsQ', 'atsA', 'rplN', 'rplX', 'rplE', 'rpsN', 'rpsH', 'rplF', 'rplR', 'rpsE', 'rpmD', 'rplO', 'sppA', 'fucA', 'serA2', 'xylB', 'secY', 'adk', 'mapA', 'sigL', 'PE_PGRS8', 'PE_PGRS9', 'PE_PGRS10', 'mmsB', 'fadE9', 'mmsA', 'PE_PGRS11', 'PPE12', 'phoP', 'phoR', 'adhB', 'cyp51', 'cyp123', 'aldA', 'purD', 'ggtA', 'purB', 'cyp126', 'hemH', 'ptrBa', 'emrB', 'purQ', 'cfp29', 'pepC', 'purL', 'cpsY', 'purF', 'purM', 'sseC1', 'cysA3', 'thiX', 'phoT', 'phoY2', 'desA1', 'PE_PGRS12', 'PE_PGRS14', 'lpqQ', 'lpqR', 'pip', 'narL', 'lpqS', 'cysK2', 'fadD16', 'pdc', 'far', 'fadA', 'fadB', 'ercc3', 'moaC', 'mog', 'moaE2', 'rpfA', 'moaD2', 'moaA', 'cspB', 'PE-PGRS15', 'fadE10', 'PPE13', 'serC', 'fprB', 'citA', 'gltA', 'ompA', 'prrB', 'prrA', 'accD3', 'echA6', 'ctpE', 'PPE14', 'PE7', 'betP', 'mntH', 'pstS3', 'pstC2', 'pstA1', 'pknD', 'pstS2', 'pstB', 'pstS1', 'pstC1', 'pstA2', 'pgi', 'uvrD1', 'sucC', 'sucD', 'purN', 'purH', 'lprP', 'ctpV', 'echA7', 'fadE12', 'accA2', 'accD2', 'fadE13', 'PE_PGRS16', 'rpmF', 'PE_PGRS18', 'mprA', 'mprB', 'pepD', 'moaB2', 'mscL', 'grcC2', 'galU', 'moeA1', 'rimJ', 'arcA', 'pabB', 'metG', 'tatD', 'rpfB', 'ksgA', 'ispE', 'pks16', 'pth', 'rplY', 'lpqT', 'prsA', 'glmU', 'mfd', 'lpqU', 'eno', 'kdpE', 'kdpD', 'kdpA', 'kdpB', 'kdpC', 'trcS', 'trcR', 'esxV', 'esxJ', 'PPE15', 'PE8', 'fadD14', 'lpqV', 'PE_PGRS19', 'PE_PGRS20', 'echA8', 'echA9', 'fadA3', 'lipU', 'cbs', 'pra', 'metB', 'greA', 'mca', 'PE_PGRS21', 'PE9', 'PE10', 'celA2b', 'coaA', 'glyA', 'desA2', 'phoH2', 'fumC', 'glpX', 'xseB', 'xseA', 'ispH', 'zwf1', 'gnd2', 'bpoB', 'ephC', 'ppdK', 'gltA1', 'metE', 'PPE16', 'echA11', 'echA10', 'mcr', 'mmpL13a', 'mmpL13b', 'omt', 'pimE', 'phhB', 'mutT2', 'narG', 'narH', 'narJ', 'narI', 'typA', 'lpqW', 'PPE17', 'PE11', 'mshB', 'PE12', 'fbiC', 'TB8.4', 'fadH', 'fdxC', 'pks4', 'papA3', 'mmpL10', 'fadD21', 'rocA', 'sigI', 'fadD36', 'PE13', 'PPE18', 'esxK', 'esxL', 'dapE', 'fadD6', 'folP2', 'tagA', 'glgC', 'PE14', 'sigE', 'htrA', 'tatB', 'lpqX', 'mrp', 'lpqY', 'sugA', 'sugB', 'sugC', 'corA', 'mdh', 'PE_PGRS23', 'lpqZ', 'kgd', 'lprE', 'deaD', 'cyp130', 'amiB2', 'pknH', 'embR', 'lprA', 'lprB', 'lprC', 'oppA', 'oppD', 'oppC', 'oppB', 'cysD', 'cysN', 'argS', 'lysA', 'thrA', 'thrC', 'thrB', 'rho', 'rpmE', 'prfA', 'hemK', 'rfe', 'atpB', 'atpE', 'atpF', 'atpH', 'atpA', 'atpG', 'atpD', 'atpC', 'murA', 'ogt', 'alkA', 'fadA4', 'PE_PGRS24', 'glgB', 'glgE', 'glgP', 'dinG', 'clpS', 'cfp10A', 'cysM', 'murI', 'rph', 'lprD', 'fadD33', 'fadE14', 'moeY', 'PPE19', 'rsfA', 'lprF', 'pyrR', 'pyrB', 'pyrC', 'carA', 'carB', 'pyrF', 'PE15', 'PPE20', 'mihF', 'gmk', 'rpoZ', 'dfp', 'metK', 'cyp132', 'PE_PGRS25', 'lipH', 'lipI', 'priA', 'fmt', 'fmu', 'rpe', 'ribG', 'lprG', 'ribC', 'ribA2', 'ribH', 'lprH', 'uvrC', 'whiA', 'lipO', 'fadD12', 'PE16', 'gap', 'pgk', 'tpiA', 'secG', 'PE_PGRS26', 'bisC', 'devB', 'opcA', 'zwf2', 'tal', 'tkt', 'ctaB', 'qor', 'csd', 'fadE15', 'PE_PGRS29', 'ctpD', 'trxA', 'trxB1', 'echA12', 'acn', 'moxR1', 'fabG1', 'inhA', 'mutA', 'mutB', 'lipL', 'gmdA', 'epiA', 'fadD25', 'mmpL12', 'wbbL2', 'pks5', 'papA4', 'fadD24', 'adh', 'ileS', 'dinX', 'ansA', 'lspA', 'lprI', 'glbN', 'dnaE', 'PPE21', 'fadD11.1', 'fadD11', 'plsB1', 'frdA', 'frdB', 'frdC', 'frdD', 'mmpL6', 'ilvA', 'treZ', 'treY', 'treX', 'bioA', 'bioF1', 'bioD', 'bioB', 'nadA', 'nadB', 'nadC', 'hisD', 'hisC1', 'hisB', 'hisH', 'hisA', 'impA', 'hisF', 'hisI', 'chaA', 'bcpB', 'trpE', 'trpC', 'trpB', 'trpA', 'lgt', 'pykA', 'tesB1', 'cydC', 'cydD', 'cydB', 'cydA', 'cya', 'polA', 'rpsA', 'coaE', 'uvrB', 'TB15.3', 'uvrA', 'lysS', 'infC', 'rpmI', 'rplT', 'tsnR', 'PE17', 'pheS', 'pheT', 'PE_PGRS30', 'argC', 'argJ', 'argB', 'argD', 'argF', 'argR', 'argG', 'argH', 'pks10', 'pks7', 'pks8', 'pks17', 'pks9', 'pks11', 'cyp139', 'dsbF', 'fadE16', 'moeX', 'mpg', 'tyrS', 'lprJ', 'tlyA', 'ppnK', 'recN', 'pyrG', 'xerD', 'cycA', 'PPE22', 'PPE23', 'cmk', 'engA', 'fadB3', 'gabD2', 'narX', 'narK2', 'pknE', 'idi', 'pknF', 'fadD1', 'PPE24', 'mmpl14', 'PE_PGRS31', 'cyp144', 'malQ', 'cyp143', 'PPE25', 'PE18', 'PPE26', 'PPE27', 'PE19', 'esxP', 'esxN', 'mycP5', 'lppT', 'PPE28', 'PPE29', 'PPE30', 'PE_PGRS32', 'PE20', 'PPE31', 'PPE32', 'PPE33', 'mgtC', 'erg3', 'PE_PGRS33', 'ilvG', 'secA2', 'pgsA2', 'gcvH', 'garA', 'cfp17', 'gcvB', 'glcB', 'PE_PGRS34', 'guaB1', 'gnd1', 'ureA', 'ureB', 'ureC', 'ureF', 'ureG', 'ureD', 'ndh', 'modA', 'modB', 'modC', 'apa', 'adhA', 'lldD2', 'bfrA', 'glnA3', 'cyp140', 'lppE', 'rpfC', 'fbpB', 'lppD', 'lipJ', 'cinA', 'nanT', 'aao', 'katG', 'furA', 'lppC', 'fadB5', 'aceAa', 'aceAb', 'PPE34', 'PPE35', 'lppF', 'lipD', 'fadD31', 'mpt63', 'tpx', 'fadE18', 'fadE17', 'echA13', 'ephB', 'ribA1', 'vapB35', 'mce3R', 'yrbE3A', 'yrbE3B', 'mce3A', 'mce3B', 'mce3C', 'mce3D', 'lprM', 'mce3F', 'mpt64', 'nrdF', 'PE_PGRS35', 'cfp21', 'mazF6', 'ydcD', 'ctpG', 'ctpF', 'fabG3', 'otsB1', 'fdxA', 'pfkB', 'hspX', 'acg', 'pncA', 'lipT', 'lppI', 'pks12', 'ppm1', 'fxsA', 'cobN', 'ydcE', 'cobG', 'cobH', 'cobI', 'blaC', 'sigC', 'cobK', 'cobM', 'cobL', 'lppJ', 'pknJ', 'pepE', 'helY', 'tatC', 'tatA', 'helZ', 'PE22', 'PPE36', 'prcA', 'prcB', 'lppK', 'hisG', 'hisE', 'PPE37', 'metH', 'PE_PGRS37', 'ansP1', 'cysS', 'cysQ', 'uppP', 'lppL', 'pyrD', 'TB18.6', 'parD2', 'wag31', 'yfiH', 'ftsZ', 'ftsQ', 'murC', 'murG', 'ftsW', 'murD', 'mraY', 'murF', 'murE', 'PE_PGRS38', 'pbpB', 'mraW', 'lppM', 'idsA2', 'pknL', 'aroG', 'TB16.3', 'fadD15', 'ctaE', 'qcrC', 'qcrA', 'qcrB', 'mmpS3', 'ctaC', 'asnB', 'cbhK', 'cobT', 'cobS', 'ilvE', 'gcvT', 'pepB', 'ephD', 'dlaT', 'lipB', 'lipA', 'glnA1', 'glnE', 'glnA2', 'panB', 'cobC', 'ptpA', 'cobD', 'ahpE', 'aceE', 'fabD', 'acpP', 'kasA', 'kasB', 'accD6', 'glpD1', 'adhE2', 'cyp124', 'cyp128', 'lppN', 'cyp121', 'pitB', 'lipM', 'yjcE', 'cdh', 'lppO', 'sseB', 'htpG', 'cut2', 'uspA', 'uspB', 'uspC', 'rocE', 'rocD2', 'rocD1', 'PE23', 'narK1', 'lppP', 'mez', 'cysK1', 'cysE', 'moeW', 'mmpL9', 'PE_PGRS39', 'lppQ', 'dnaG', 'dgt', 'esxO', 'plcC', 'plcB', 'plcA', 'PPE38', 'PPE40', 'glyS', 'furB', 'recO', 'amiA2', 'era', 'phoH1', 'PE_PGRS40', 'dnaJ2', 'hrcA', 'cfp2', 'mbtH', 'mbtG', 'mbtF', 'mbtE', 'mbtD', 'mbtC', 'mbtB', 'mbtA', 'mbtJ', 'mbtI', 'hemN', 'rpfD', 'nirA', 'cysH', 'ggtB', 'PE_PGRS41', 'cysA1', 'cysW', 'cysT', 'subI', 'lppR', 'lepA', 'rpsT', 'eis', 'nadD', 'proA', 'ahpC', 'ahpD', 'PPE41', 'PE25', 'rbsK', 'nadE', 'proB', 'obgE', 'rpmA', 'rplU', 'rne', 'ndk', 'folC', 'valS', 'rpfE', 'mobA', 'clpX', 'mmuM', 'clpP2', 'clpP', 'tig', 'lipP', 'pepN', 'glbO', 'aglA', 'gdh', 'plsB2', 'plsC', 'lipQ', 'echA14', 'PE_PGRS42', 'pdhC', 'pdhB', 'pdhA', 'citE', 'fadE19', 'accA1', 'accD1', 'scoB', 'scoA', 'fadD35', 'orn', 'lppS', 'PE26', 'bcp', 'acpS', 'fas', 'mrr', 'nusB', 'efp', 'pepQ', 'aroD', 'aroB', 'aroK', 'aroF', 'lppA', 'lppB', 'aroE', 'alaS', 'glnQ', 'aspS', 'dhaA', 'hisS', 'ppiB', 'relA', 'apt', 'secF', 'secD', 'yajC', 'gabT', 'fadD9', 'PE_PGRS44', 'ruvB', 'ruvA', 'ruvC', 'speE', 'pdxT', 'tesB2', 'pdxH', 'PPE42', 'pimA', 'pgsA1', 'thrS', 'TB31.7', 'PE_PGRS46', 'dedA', 'cadI', 'arsC', 'clpC2', 'ribD', 'hemY', 'hemE', 'echA15', 'dxs1', 'arsA', 'arsB1', 'ceoB', 'ceoC', 'dut', 'suhB', 'ppgK', 'sigA', 'sigB', 'ideR', 'sthA', 'lexA', 'fadE20', 'hflX', 'dapF', 'miaA', 'recX', 'recA', 'PE_PGRS47', '35kd_ag', 'pgsA3', 'ftsK', 'dapA', 'thyX', 'hsdS.1', 'hsdM', 'hsdS', 'dfrA', 'thyA', 'PPE43', 'PE27', 'PPE44', 'dapB', 'ald', 'pepR', 'gpsI', 'lppU', 'rpsO', 'ribF', 'sirR', 'fadE21', 'ltp1', 'truB', 'lppV', 'echA16', 'ugpC', 'ugpB', 'ugpE', 'ugpA', 'dinF', 'rbfA', 'infB', 'nusA', 'proS', 'efpA', 'cysG', 'cobB', 'cobO', 'mqo', 'PE_PGRS48', 'mtr', 'nicT', 'hypB', 'aldC', 'glnA4', 'mapB', 'ispG', 'dxr', 'mpt83', 'dipZ', 'mpt70', 'mpt53', 'CDSA', 'frr', 'pyrH', 'amiC', 'tsf', 'rpsB', 'PPE45', 'xerC', 'viuB', 'fdhD', 'fdhF', 'rnhB', 'lepB', 'rplS', 'lppW', 'trmD', 'rimM', 'rpsP', 'dacB2', 'pknI', 'ffh', 'glnD', 'glnB', 'amt', 'ftsY', 'smc', 'acyP', 'fpg', 'rnc', 'tesA', 'fadD26', 'ppsA', 'ppsB', 'ppsC', 'ppsD', 'ppsE', 'drrA', 'drrB', 'drrC', 'papA5', 'mas', 'fadD28', 'mmpL7', 'lppX', 'pks1', 'pks15', 'fadD22', 'fadD29', 'purU', 'coaD', 'pca', 'lipN', 'recG', 'ung', 'thiL', 'ddl', 'ppk', 'mutT1', 'leuD', 'leuC', 'gltX', 'leuB', 'serA1', 'lppY', 'ilvC', 'ilvH', 'ilvB1', 'cfp6', 'lppZ', 'gatB', 'pfkA', 'gatA', 'gatC', 'ligA', 'lpqA', 'esxQ', 'PPE46', 'PE27A', 'esxR', 'esxS', 'PE29', 'trmU', 'iscS', 'fixB', 'fixA', 'TB22.2', 'echA17', 'serB2', 'ctaD', 'fecB', 'adhC', 'nrdE', 'nrdI', 'nrdH', 'dinP', 'cyp136', 'fadE22', 'ligB', 'cstA', 'mmr', 'pgmA', 'ccrB', 'hab', 'pknK', 'virS', 'lipR', 'adhD', 'fadD13', 'lipY', 'smpB', 'ftsX', 'ftsE', 'prfB', 'fprA', 'agpS', 'moaA1', 'moaB1', 'moeB2', 'moaE1', 'cyp141', 'PPE49', 'tgs1', 'devS', 'devR', 'PPE50', 'PPE51', 'pflA', 'fadE24', 'fadE23', 'fadB4', 'PPE52', 'nuoA', 'nuoB', 'nuoC', 'nuoD', 'nuoE', 'nuoF', 'nuoG', 'nuoH', 'nuoI', 'nuoJ', 'nuoK', 'nuoL', 'nuoM', 'nuoN', 'PPE53', 'moxR3', 'aofH', 'hpx', 'mesT', 'uvrD2', 'nudC', 'lipV', 'moeB1', 'TB9.4', 'rhlE', 'gpm2', 'entC', 'whiB1', 'TB7.3', 'rshA', 'sigH', 'aroA', 'pvdS', 'secA1', 'lpqB', 'mtrB', 'mtrA', 'tmk', 'sahH', 'rubB', 'rubA', 'alkB', 'manA', 'manB', 'whiB2', 'fbiA', 'fbiB', 'wbbL1', 'rmlD', 'ctpC', 'fadE25', 'purE', 'purK', 'birA', 'accD5', 'maf', 'sseA', 'accA3', 'sigF', 'rsbW', 'usfY', 'lat', 'pcd', 'lhr', 'nei', 'lpqC', 'atsB', 'phoY1', 'glpD2', 'lpdA', 'amiA1', 'amiB1', 'deoD', 'pmmB', 'upp', 'add', 'deoA', 'cdd', 'sdhC', 'sdhD', 'sdhB', 'moaX', 'moaC3', 'dacB1', 'sugI', 'nagA', 'trpS', 'icd1', 'metC', 'metX', 'PPE55', 'PPE56', 'folD', 'spoU', 'dnaE2', 'otsB2', 'echA18', 'echA18.1', 'amiD', 'dxs2', 'lytB1', 'idsB', 'PE_PGRS52', 'lpqD', 'acrA1', 'cmaA1', 'iunH', 'guaA', 'phyA', 'idsA1', 'choD', 'guaB3', 'guaB2', 'sigD', 'whiB3', 'groES', 'gcp', 'rimI', 'alr', 'PPE57', 'PPE58', 'gadB', 'glmS', 'mrsA', 'rpsI', 'rplM', 'esxT', 'esxU', 'mycP4', 'cut3', 'cut4', 'truA', 'rplQ', 'rpoA', 'rpsD', 'rpsK', 'rpsM', 'infA', 'rmlB', 'rmlC', 'mhpE', 'ilvB2', 'bpoA', 'kgtP', 'PE31', 'PPE60', 'cpsA', 'lipF', 'otsA', 'mce4F', 'lprN', 'mce4D', 'mce4C', 'mce4B', 'mce4A', 'yrbE4B', 'yrbE4A', 'fdxD', 'fadE26', 'fadE27', 'fadD17', 'PE_PGRS53', 'PE_PGRS54', 'ilvX', 'PE_PGRS55', 'fadD19', 'echA19', 'cyp142', 'ltp4', 'ltp3', 'PPE61', 'PPE62', 'PPE63', 'ltp2', 'fadE29', 'fadE28', 'cyp125', 'fadA5', 'echA20', 'fdxB', 'fadA6', 'PPE64', 'fadE30', 'fadD3', 'fadE31', 'fadE32', 'fadE33', 'aspB', 'nat', 'bphC', 'bphD', 'hmp', 'fadE34', 'lppH', 'arsB2', 'ispF', 'ispD', 'lpqE', 'radA', 'mutY', 'PE_PGRS58', 'TB11.2', 'lpqF', 'PE_PGRS59', 'clpC1', 'lsr2', 'panD', 'panC', 'folK', 'folB', 'folP1', 'folE', 'ftsH', 'ephA', 'PPE65', 'PE32', 'lpqG', 'hpt', 'mesJ', 'ppa', 'galE1', 'istA', 'fic', 'topA', 'cspA', 'PE33', 'dppD', 'dppC', 'dppB', 'dppA', 'acs', 'ephE', 'nth', 'whiB4', 'ponA2', 'cyp137', 'rsfB', 'moxR2', 'glpK', 'gshA', 'asd', 'ask', 'leuA', 'dnaQ', 'cobQ2', 'recR', 'dnaZX', 'cut5a', 'cut5b', 'ligC', 'PPE66', 'PPE67', 'ctpJ', 'PE34', 'tyrA', 'proZ', 'proW', 'proV', 'proX', 'fadE36', 'lpqH', 'hisC2', 'echA21', 'lipE', 'rfbE', 'rfbD', 'embC', 'embA', 'embB', 'fadE35', 'accD4', 'pks13', 'fadD32', 'fbpD', 'fbpA', 'glfT', 'glf', 'pirG', 'PE_PGRS62', 'papA2', 'mmpL8', 'papA1', 'pks2', 'fadD23', 'serS', 'pheA', 'bfrB', 'glpQ1', 'sodA', 'hns', 'menG', 'ethA', 'ethR', 'gltD', 'gltB', 'whiB6', 'PE35', 'PPE68', 'esxB', 'esxA', 'mycP1', 'mycP2', 'espG2', 'esxC', 'esxD', 'PPE69', 'PE36', 'esxE', 'esxF', 'pcnA', 'trxB2', 'trxC', 'parB', 'parA', 'gidB', 'rnpA']

if __name__=="__main__":
    parser = collect_args()
    params = parser.parse_args()
    if params.viruses_per_month == 0:
        config["subsample"] = False
    else:
        config["subsample"]["threshold"] = params.viruses_per_month

    if params.sequences is not None:
        config["input_paths"] = params.sequences

    if params.file_prefix is not None:
        config["file_prefix"] = params.file_prefix

    runner = prepare(config)
    runner.load_references()
    runner.applyFilters()
    runner.ensure_all_segments()
    runner.subsample()
    runner.colors()
    runner.latlongs()
    runner.write_to_json()
